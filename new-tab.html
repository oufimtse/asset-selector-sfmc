<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="https://experience.adobe.com/solutions/CQ-assets-selectors/static-assets/resources/assets-selectors.js"></script>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript">
        async function newTabAuth() {
            const assetSelectorProps = {
            }
            // container element on which you want to render the AssetSelector/DestinationSelector component
            const container = document.getElementById('asset-selector');

            window.assetsSelectorsAuthService.adobeIms.signInservice._signIn = window.assetsSelectorsAuthService.adobeIms.signInservice.signIn;
            window.assetsSelectorsAuthService.adobeIms.signInservice.signIn = async function( redirectRequest ) {
                console.log('=== signIn');
                window._open = window.open;
                window.open = function( url, target, features ) {
                    console.log('=== open', url, target, features);
                    return window._open( url, target, '' );
                };
                this._signIn( redirectRequest );
                window.open = window._open;
            };


            /// Use the PureJSSelectors in globals to render the AssetSelector/DestinationSelector component
            PureJSSelectors.renderAssetSelectorWithAuthFlow(container, assetSelectorProps, async() => {
                const assetSelectorDialog = document.getElementById('asset-selector-dialog');
                assetSelectorDialog.showModal();
            });
        }

        const registeredTokenService = PureJSSelectors.registerAssetsSelectorsAuthService(imsProps);
    </script>
</head>

<body>
    <button onclick="newTabAuth()">New tab auth</button>

    <dialog id="asset-selector-dialog">
        <div id="asset-selector" style="height: calc(100vh - 80px); width: calc(100vw - 60px); margin: -20px;">
        </div>
    </dialog>
</body>
</html>