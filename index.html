<!DOCTYPE html>
<html>

<head>
    <script
        src="https://experience.adobe.com/solutions/CQ-assets-selectors/static-assets/resources/assets-selectors.js"></script>
    <script type="text/javascript">
        //function that will render the asset selector
        function defaultAuth() {
            const assetSelectorProps = {
            }
            // container element on which you want to render the AssetSelector/DestinationSelector component
            const container = document.getElementById('asset-selector');

            /// Use the PureJSSelectors in globals to render the AssetSelector/DestinationSelector component
            PureJSSelectors.renderAssetSelectorWithAuthFlow(container, assetSelectorProps, () => {
                const assetSelectorDialog = document.getElementById('asset-selector-dialog');
                assetSelectorDialog.showModal();
            });
        }

        const imsProps = {
            imsClientId: 'aemcs-sasha-assetselector',
            imsOrg: '76B329395DF155D60A495E2C@AdobeOrg/',
            imsScope: 'AdobeID,openid,additional_info.projectedProductContext,read_organizations',
            redirectUrl: window.location.href,
            modalMode: true,
            onImsServiceInitialized: (service) => {
                console.log('onImsServiceInitialized', service);
            },
            onAccessTokenReceived: (token) => {
                console.log('onAccessTokenReceived', token);
            },
            onAccessTokenExpired: () => {
                console.log('onAccessTokenError');
            },
            onErrorReceived: (type, msg) => {
                console.log('onErrorReceived', type, msg);
            },
        };

        async function constructPopupUrl(service) {
            const nonce = service.adobeIms.csrfService.initialize();
            const redirectRequest = await service.adobeIms.adobeIdData.createRedirectRequest({ redirectUrl: window.location.href }, null, service.adobeIms.csrfService.initialize(), 'token');
            const popupUrl = service.adobeIms.signInservice.createRedirectUrl( redirectRequest );
            console.log('popupUrl', popupUrl);
            return popupUrl;
        }

        async function authViaNewTab() {
            const assetSelectorProps = {
            }
            // container element on which you want to render the AssetSelector/DestinationSelector component
            const container = document.getElementById('asset-selector');

            /// Use the PureJSSelectors in globals to render the AssetSelector/DestinationSelector component
            PureJSSelectors.renderAssetSelectorWithAuthFlow(container, assetSelectorProps, async() => {
                const popupUrl = await constructPopupUrl(registeredTokenService);
                window.open(popupUrl, '_blank');
            });
        }

        const registeredTokenService = PureJSSelectors.registerAssetsSelectorsAuthService(imsProps);

    </script>
</head>

<body>
    <button onclick="defaultAuth()">Default</button>
    <button onclick="authViaNewTab()">New tab</button>


    <dialog id="asset-selector-dialog">
        <div id="asset-selector" style="height: calc(100vh - 80px); width: calc(100vw - 60px); margin: -20px;">
        </div>
    </dialog>



</body>

</html>